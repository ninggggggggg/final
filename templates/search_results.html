{% extends "base.html" %}

{% block title %}Káº¿t quáº£ tÃ¬m kiáº¿m - Há»‡ thá»‘ng quáº£n lÃ½ tÃ i liá»‡u{% endblock %}

{% block content %}
<div class="container">
    <div class="navbar">
        <div class="user-info">
            <h2>ğŸ” Káº¿t quáº£ tÃ¬m kiáº¿m</h2>
            {% if request.args.get('q') %}
            <p style="color: #999; font-size: 0.9rem;">Tá»« khÃ³a: "{{ request.args.get('q') }}"</p>
            {% endif %}
        </div>
        <div>
            {% if session.role == 'student' %}
                <a href="/student" class="btn btn-secondary">â† Quay láº¡i</a>
            {% elif session.role == 'teacher' %}
                <a href="/teacher" class="btn btn-secondary">â† Quay láº¡i</a>
            {% endif %}
            <a href="/logout" class="btn btn-secondary">ğŸšª ÄÄƒng xuáº¥t</a>
        </div>
    </div>

    <div class="search-form">
        <form action="/search" method="get">
            <input type="hidden" name="role" value="{{ request.args.get('role', '') }}">
            <input type="text" 
                   name="q" 
                   placeholder="TÃ¬m kiáº¿m..." 
                   value="{{ request.args.get('q', '') }}">
            <button type="submit" class="btn">ğŸ” TÃ¬m láº¡i</button>
        </form>
    </div>

    <div class="result-info" style="margin-bottom: 2rem;">
        <h3>ğŸ“Š TÃ¬m tháº¥y {{ files|length }} káº¿t quáº£</h3>
        {% if request.args.get('q') %}
        <p style="color: #666;">Káº¿t quáº£ cho tá»« khÃ³a: <strong>"{{ request.args.get('q') }}"</strong></p>
        {% endif %}
    </div>

    {% if files %}
    <ul class="file-list">
        {% for file in files %}
        <li>
            <div style="display: flex; align-items: center; gap: 1rem; flex: 1;">
                <div style="font-size: 1.5rem;">
                    {% if file.endswith(('.pdf',)) %}ğŸ“„
                    {% elif file.endswith(('.doc', '.docx')) %}ğŸ“
                    {% elif file.endswith(('.ppt', '.pptx')) %}ğŸ“Š
                    {% elif file.endswith(('.xls', '.xlsx')) %}ğŸ“ˆ
                    {% elif file.endswith(('.jpg', '.jpeg', '.png')) %}ğŸ–¼ï¸
                    {% elif file.endswith(('.txt',)) %}ğŸ“‹
                    {% else %}ğŸ“
                    {% endif %}
                </div>
                <div>
                    <strong>{{ file }}</strong>
                    <div style="font-size: 0.9rem; color: #666;">
                        {% if file.endswith(('.pdf',)) %}TÃ i liá»‡u PDF
                        {% elif file.endswith(('.doc', '.docx')) %}TÃ i liá»‡u Word
                        {% elif file.endswith(('.ppt', '.pptx')) %}BÃ i thuyáº¿t trÃ¬nh
                        {% elif file.endswith(('.xls', '.xlsx')) %}Báº£ng tÃ­nh Excel
                        {% elif file.endswith(('.jpg', '.jpeg', '.png')) %}HÃ¬nh áº£nh
                        {% elif file.endswith(('.txt',)) %}File vÄƒn báº£n
                        {% else %}File khÃ¡c
                        {% endif %}
                    </div>
                </div>
            </div>
            <div>
                <a href="/uploads/{{ request.args.get('role', '') }}/{{ file }}" 
                   class="btn" 
                   style="padding: 0.5rem 1rem; font-size: 0.9rem;"
                   target="_blank">
                    ğŸ“¥ Táº£i vá»
                </a>
            </div>
        </li>
        {% endfor %}
    </ul>
    {% else %}
    <div style="text-align: center; padding: 3rem; background: #f8f9fa; border-radius: 10px; margin-top: 2rem;">
        <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ”</div>
        <h3>KhÃ´ng tÃ¬m tháº¥y káº¿t quáº£</h3>
        <p style="color: #666; margin-top: 1rem;">
            {% if request.args.get('q') %}
                KhÃ´ng cÃ³ file nÃ o chá»©a tá»« khÃ³a "<strong>{{ request.args.get('q') }}</strong>"
            {% else %}
                ChÆ°a cÃ³ file nÃ o Ä‘Æ°á»£c táº£i lÃªn
            {% endif %}
        </p>
        
        <div style="margin-top: 2rem;">
            {% if session.role == 'teacher' %}
            <p style="color: #666;">Báº¡n cÃ³ thá»ƒ:</p>
            <a href="/teacher" class="btn">ğŸ“¤ Táº£i lÃªn tÃ i liá»‡u má»›i</a>
            {% endif %}
        </div>
    </div>
    {% endif %}

    {% if files and request.args.get('q') %}
    <div style="margin-top: 2rem; padding: 1rem; background: #e8f5e8; border-radius: 5px; border-left: 4px solid #4caf50;">
        <h4>ğŸ’¡ Gá»£i Ã½ tÃ¬m kiáº¿m khÃ¡c:</h4>
        <div style="margin-top: 1rem;">
            <a href="/search?role={{ request.args.get('role', '') }}&q=bÃ i giáº£ng" class="btn" style="margin: 0.25rem; padding: 0.5rem 1rem; font-size: 0.9rem;">BÃ i giáº£ng</a>
            <a href="/search?role={{ request.args.get('role', '') }}&q=Ä‘á» thi" class="btn" style="margin: 0.25rem; padding: 0.5rem 1rem; font-size: 0.9rem;">Äá» thi</a>
            <a href="/search?role={{ request.args.get('role', '') }}&q=tÃ i liá»‡u" class="btn" style="margin: 0.25rem; padding: 0.5rem 1rem; font-size: 0.9rem;">TÃ i liá»‡u</a>
            <a href="/search?role={{ request.args.get('role', '') }}" class="btn btn-secondary" style="margin: 0.25rem; padding: 0.5rem 1rem; font-size: 0.9rem;">Xem táº¥t cáº£</a>
        </div>
    </div>
    {% endif %}
</div>

<script>
// Highlight search terms
document.addEventListener('DOMContentLoaded', function() {
    const searchTerm = '{{ request.args.get("q", "") }}';
    if (searchTerm) {
        const fileItems = document.querySelectorAll('.file-list li strong');
        fileItems.forEach(item => {
            const regex = new RegExp(`(${searchTerm})`, 'gi');
            item.innerHTML = item.innerHTML.replace(regex, '<mark style="background: #ffeb3b; padding: 0.1rem;">$1</mark>');
        });
    }
});
</script>
{% endblock %}